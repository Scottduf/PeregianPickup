(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const e of a)if(e.type==="childList")for(const h of e.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function t(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerPolicy&&(e.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?e.credentials="include":a.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function l(a){if(a.ep)return;a.ep=!0;const e=t(a);fetch(a.href,e)}})();class M{constructor(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.gameState="playing",this.gameTime=60,this.timeLeft=this.gameTime,this.score=0,this.gameSpeed=1,this.player={x:400,y:300,width:40,height:40,speed:4,vx:0,vy:0,carrying:null,color:"#4A90E2",direction:"down",animFrame:0,animSpeed:.2,immune:!0,immuneTimer:180},this.touches={},this.setupTouchControls(),this.trash=[],this.bins=[],this.enemies=[],this.particles=[],this.obstacles=[],this.soundEffects={},this.initializeSounds(),this.initializeBins(),this.initializeObstacles(),this.spawnTrash(),this.spawnEnemies(),this.loadLeaderboard(),this.gameLoop(),this.startTimer()}initializeSounds(){this.audioContext=null;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{console.log("Audio not supported")}}playSound(i,t,l="sine",a=.1){if(this.audioContext)try{const e=this.audioContext.createOscillator(),h=this.audioContext.createGain();e.connect(h),h.connect(this.audioContext.destination),e.frequency.setValueAtTime(i,this.audioContext.currentTime),e.type=l,h.gain.setValueAtTime(0,this.audioContext.currentTime),h.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+.01),h.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+t),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+t)}catch{console.log("Sound playback failed")}}playBinSound(i=!0){i?(this.playSound(523,.1,"sine",.15),setTimeout(()=>this.playSound(659,.1,"sine",.15),50),setTimeout(()=>this.playSound(784,.15,"sine",.15),100)):this.playSound(392,.2,"square",.1)}playTurkeySound(){this.playSound(200,.05,"sawtooth",.2),setTimeout(()=>this.playSound(180,.05,"sawtooth",.15),60),setTimeout(()=>this.playSound(220,.05,"sawtooth",.15),120),setTimeout(()=>this.playSound(160,.1,"sawtooth",.1),180)}setupTouchControls(){this.canvas.addEventListener("touchstart",i=>{i.preventDefault();const t=i.touches[0],l=this.canvas.getBoundingClientRect(),a=t.clientX-l.left,e=t.clientY-l.top;this.movePlayerTowards(a,e)}),this.canvas.addEventListener("touchmove",i=>{i.preventDefault();const t=i.touches[0],l=this.canvas.getBoundingClientRect(),a=t.clientX-l.left,e=t.clientY-l.top;this.movePlayerTowards(a,e)}),this.canvas.addEventListener("click",i=>{const t=this.canvas.getBoundingClientRect(),l=i.clientX-t.left,a=i.clientY-t.top;this.movePlayerTowards(l,a)}),document.addEventListener("keydown",i=>{this.handleKeyboard(i.key)})}movePlayerTowards(i,t){const l=i-(this.player.x+this.player.width/2),a=t-(this.player.y+this.player.height/2),e=Math.sqrt(l*l+a*a);e>5?(this.player.vx=l/e*this.player.speed,this.player.vy=a/e*this.player.speed):(this.player.vx=0,this.player.vy=0)}handleKeyboard(i){const t=this.player.speed;switch(i){case"ArrowUp":case"w":this.player.vy=-t;break;case"ArrowDown":case"s":this.player.vy=t;break;case"ArrowLeft":case"a":this.player.vx=-t;break;case"ArrowRight":case"d":this.player.vx=t;break}}initializeBins(){this.bins=[{x:50,y:50,width:60,height:80,type:"recycle",color:"#4A90E2",label:"Recycle"},{x:50,y:200,width:60,height:80,type:"compost",color:"#7ED321",label:"Compost"},{x:50,y:350,width:60,height:80,type:"trash",color:"#2D5016",label:"Trash"}]}initializeObstacles(){this.obstacles=[{x:300,y:150,width:80,height:100,type:"slide",color:"#FF6B6B"},{x:500,y:300,width:60,height:60,type:"roundabout",color:"#4ECDC4"},{x:200,y:250,width:50,height:80,type:"tree",color:"#228B22"},{x:600,y:150,width:55,height:85,type:"tree",color:"#32CD32"},{x:450,y:100,width:80,height:30,type:"bench",color:"#8B4513"}]}spawnTrash(){const i=[{type:"recycle",color:"#4A90E2",items:[{name:"bottle",shape:"bottle",color:"#87CEEB",detail:"#4169E1"},{name:"can",shape:"can",color:"#C0C0C0",detail:"#FF6347"},{name:"paper",shape:"paper",color:"#F5F5DC",detail:"#000080"}]},{type:"compost",color:"#7ED321",items:[{name:"banana",shape:"banana",color:"#FFD700",detail:"#8B4513"},{name:"apple",shape:"apple",color:"#FF6347",detail:"#228B22"},{name:"leaves",shape:"leaves",color:"#228B22",detail:"#8B4513"}]},{type:"trash",color:"#2D5016",items:[{name:"wrapper",shape:"wrapper",color:"#FF69B4",detail:"#8A2BE2"},{name:"gum",shape:"gum",color:"#FF1493",detail:"#B22222"},{name:"chip_bag",shape:"bag",color:"#FFD700",detail:"#FF4500"}]}];for(let t=0;t<18;t++){const l=i[Math.floor(Math.random()*i.length)],a=l.items[Math.floor(Math.random()*l.items.length)];let e=0,h=!1,s;for(;!h&&e<30;){s={x:Math.random()*(this.canvas.width-200)+150,y:Math.random()*(this.canvas.height-100)+50,width:24,height:24,type:l.type,item:a.name,shape:a.shape,color:a.color,detailColor:a.detail,rotation:Math.random()*.4-.2},h=!0;for(let o of[...this.obstacles,...this.bins])if(this.isColliding(s,o)){h=!1;break}e++}h&&this.trash.push(s)}}spawnEnemies(){for(let i=0;i<4;i++)this.enemies.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,width:40,height:40,speed:2,chaseSpeed:3.5,color:"#8B4513",chasing:!1,alertDistance:150,aggressionLevel:0,lastPlayerDistance:999,animFrame:Math.random()*4})}updatePlayer(){if(this.player.immune&&(this.player.immuneTimer--,this.player.immuneTimer<=0&&(this.player.immune=!1)),this.player.vx||this.player.vy){const i=this.player.x,t=this.player.y;this.player.x+=this.player.vx,this.player.y+=this.player.vy;let l=!1;for(let a of this.obstacles)if(this.isColliding(this.player,a)){this.player.x=i,this.player.y=t,this.player.vx=0,this.player.vy=0,l=!0;break}if(!l){for(let a of this.bins)if(this.isColliding(this.player,a)){const e=Math.min(this.player.x+this.player.width-a.x,a.x+a.width-this.player.x),h=Math.min(this.player.y+this.player.height-a.y,a.y+a.height-this.player.y);if(e>10&&h>10){this.player.x=i,this.player.y=t,this.player.vx=0,this.player.vy=0,l=!0;break}}}l||(this.player.vx*=.9,this.player.vy*=.9,Math.abs(this.player.vx)<.1&&(this.player.vx=0),Math.abs(this.player.vy)<.1&&(this.player.vy=0))}this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,this.player.y))}updateEnemies(){this.enemies.forEach(i=>{i.wanderAngle||(i.wanderAngle=Math.random()*Math.PI*2),i.wanderTimer||(i.wanderTimer=0),i.alertDistance||(i.alertDistance=150),i.aggressionLevel||(i.aggressionLevel=0),i.satisfiedTimer||(i.satisfiedTimer=0),i.satisfiedTimer>0&&(i.satisfiedTimer--,i.aggressionLevel=Math.max(i.aggressionLevel-.05,0));const t=Math.sqrt(Math.pow(this.player.x-i.x,2)+Math.pow(this.player.y-i.y,2));if(this.player.carrying&&!this.player.immune&&i.satisfiedTimer<=0?i.aggressionLevel=Math.min(i.aggressionLevel+.01,.6):i.aggressionLevel=Math.max(i.aggressionLevel-.02,0),this.player.carrying&&!this.player.immune&&t<i.alertDistance&&i.aggressionLevel>.3&&i.satisfiedTimer<=0){i.chasing=!0;const l=this.player.x-i.x,a=this.player.y-i.y;if(Math.sqrt(l*l+a*a)>0){const h=i.chaseSpeed*(.7+i.aggressionLevel*.3),s=this.player.x+(this.player.vx||0)*10,o=this.player.y+(this.player.vy||0)*10,r=s-i.x,n=o-i.y,d=Math.sqrt(r*r+n*n);d>0&&(i.x+=r/d*h,i.y+=n/d*h),i.x+=(Math.random()-.5)*1,i.y+=(Math.random()-.5)*1}Math.random()<.005&&this.playTurkeySound()}else if(!this.player.carrying&&i.chasing&&t<80){i.chasing=!1,i.fleeing=!0,i.fleeTimer=90;const l=i.x-this.player.x,a=i.y-this.player.y,e=Math.sqrt(l*l+a*a);e>0&&(i.x+=l/e*i.speed*2.5,i.y+=a/e*i.speed*2.5)}else if(i.fleeing&&i.fleeTimer>0){i.fleeTimer--;const l=i.x-this.player.x,a=i.y-this.player.y,e=Math.sqrt(l*l+a*a);e>0&&(i.x+=l/e*i.speed*1.5,i.y+=a/e*i.speed*1.5),i.fleeTimer<=0&&(i.fleeing=!1)}else{i.chasing=!1,i.fleeing=!1,i.wanderTimer++,i.wanderTimer>40+Math.random()*80&&(i.wanderAngle=Math.random()*Math.PI*2,i.wanderTimer=0);const l=i.speed*.8;i.x+=Math.cos(i.wanderAngle)*l,i.y+=Math.sin(i.wanderAngle)*l;const a=50;i.x<a&&(i.wanderAngle=Math.random()*Math.PI-Math.PI/2),i.x>this.canvas.width-a&&(i.wanderAngle=Math.random()*Math.PI+Math.PI/2),i.y<a&&(i.wanderAngle=Math.random()*Math.PI),i.y>this.canvas.height-a&&(i.wanderAngle=Math.random()*Math.PI+Math.PI)}for(let l of[...this.obstacles,...this.bins])if(this.isColliding(i,l)){const a=i.x+i.width/2-(l.x+l.width/2),e=i.y+i.height/2-(l.y+l.height/2);i.wanderAngle=Math.atan2(e,a)+(Math.random()-.5)*Math.PI/3;const h=Math.sqrt(a*a+e*e);h>0&&(i.x+=a/h*15,i.y+=e/h*15);break}i.x=Math.max(0,Math.min(this.canvas.width-i.width,i.x)),i.y=Math.max(0,Math.min(this.canvas.height-i.height,i.y)),i.lastPlayerDistance=t})}checkCollisions(){this.player.carrying||this.trash.forEach((i,t)=>{this.isColliding(this.player,i)&&(this.player.carrying=i,this.trash.splice(t,1),this.updateUI(),this.playSound(440,.1,"sine",.1))}),this.player.carrying&&this.bins.forEach(i=>{this.isColliding(this.player,i)&&(this.player.carrying.type===i.type?(this.score+=10,this.createSuccessEffect(i.x+i.width/2,i.y+i.height/2),this.playBinSound(!0)):(this.score+=1,this.createFailEffect(i.x+i.width/2,i.y+i.height/2),this.playBinSound(!1)),this.player.carrying=null,this.updateUI(),Math.random()<.4&&this.spawnNewTrash())}),this.player.carrying&&!this.player.immune&&this.enemies.forEach(i=>{if(this.isColliding(this.player,i)){this.createPeckEffect(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.playTurkeySound(),this.player.carrying=null,this.updateUI(),this.player.immune=!0,this.player.immuneTimer=90;const t=i.x-this.player.x,l=i.y-this.player.y,a=Math.sqrt(t*t+l*l);a>0&&(i.x+=t/a*40,i.y+=l/a*40),i.aggressionLevel=0,i.chasing=!1,i.satisfiedTimer=180,this.cameraShake=5}})}createSuccessEffect(i,t){for(let l=0;l<15;l++)this.particles.push({x:i,y:t,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8-2,life:30,maxLife:30,color:"#00FF00",size:Math.random()*4+2,type:"success"});this.particles.push({x:i,y:t-20,vx:0,vy:-2,life:60,maxLife:60,color:"#00FF00",size:16,type:"scoreText",text:"+10"})}createFailEffect(i,t){for(let l=0;l<8;l++)this.particles.push({x:i,y:t,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,life:20,maxLife:20,color:"#FF6600",size:Math.random()*3+1,type:"fail"});this.particles.push({x:i,y:t-20,vx:0,vy:-1,life:40,maxLife:40,color:"#FF6600",size:14,type:"scoreText",text:"+1"})}createPeckEffect(i,t){for(let l=0;l<15;l++)this.particles.push({x:i,y:t,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:30,maxLife:30,color:Math.random()>.5?"#D2691E":"#8B4513",size:Math.random()*4+2,type:"feather"});this.particles.push({x:i,y:t-15,vx:0,vy:-2,life:60,maxLife:60,color:"#F5A623",size:16,type:"scoreText",text:"PECKED!"})}createImpactEffect(i,t){for(let l=0;l<20;l++)this.particles.push({x:i,y:t,vx:(Math.random()-.5)*12,vy:(Math.random()-.5)*12,life:25,maxLife:25,color:"#FF0000",size:Math.random()*5+2,type:"impact"});this.particles.push({x:i,y:t-15,vx:0,vy:-3,life:45,maxLife:45,color:"#FF0000",size:18,type:"scoreText",text:"CAUGHT!"})}updateParticles(){this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.life--,i.type!=="scoreText"&&(i.vy+=.2),i.alpha=i.life/i.maxLife,i.life>0))}spawnNewTrash(){const i=[{type:"recycle",color:"#2196F3",items:["bottle","can","paper"]},{type:"compost",color:"#FF9800",items:["apple","banana","leaves"]},{type:"trash",color:"#F44336",items:["wrapper","gum","broken_toy"]}],t=i[Math.floor(Math.random()*i.length)],l=t.items[Math.floor(Math.random()*t.items.length)];let a=0,e=!1,h;for(;!e&&a<20;){h={x:Math.random()*(this.canvas.width-200)+150,y:Math.random()*(this.canvas.height-100)+50,width:20,height:20,type:t.type,item:l,color:t.color},e=!0;for(let s of[...this.obstacles,...this.bins])if(this.isColliding(h,s)){e=!1;break}a++}e&&this.trash.push(h)}drawPlayer(){const i=this.ctx,t=this.player;let l=0,a=0;this.cameraShake&&this.cameraShake>0&&(l=(Math.random()-.5)*this.cameraShake,a=(Math.random()-.5)*this.cameraShake,this.cameraShake--);const e=t.x+l,h=t.y+a;t.immune&&Math.floor(t.immuneTimer/6)%2===0&&(i.globalAlpha=.5),(t.vx!==0||t.vy!==0)&&(t.animFrame+=t.animSpeed,t.animFrame>=8&&(t.animFrame=0),Math.abs(t.vx)>Math.abs(t.vy)?t.direction=t.vx>0?"right":"left":t.vy!==0&&(t.direction=t.vy>0?"down":"up")),i.fillStyle="rgba(0,0,0,0.3)",i.beginPath(),i.ellipse(e+t.width/2,h+t.height+8,t.width/2+2,10,0,0,Math.PI*2),i.fill(),i.fillStyle="#F5A623";const s=Math.sin(t.animFrame*.5)*3,o=Math.sin(t.animFrame*.8)*2;i.beginPath(),i.moveTo(e-2+o,h+8),i.quadraticCurveTo(e-8+s,h+20,e-1+o,h+32),i.quadraticCurveTo(e+5+s,h+35,e+8+o,h+30),i.quadraticCurveTo(e+6,h+15,e+3,h+8),i.closePath(),i.fill();const r=i.createLinearGradient(e,h,e+t.width,h+25);r.addColorStop(0,"#7ED321"),r.addColorStop(.5,"#4A90E2"),r.addColorStop(1,"#2D5016"),i.fillStyle=r,i.fillRect(e+6,h+14,28,22),i.fillStyle="#2D5016",i.fillRect(e+10,h+18,8,6),i.fillRect(e+22,h+18,8,6),i.fillStyle="#F5A623",i.fillRect(e+8,h+28,24,4),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(e+t.width/2,h+12,14,0,Math.PI*2),i.fill();const n=i.createLinearGradient(e,h,e+t.width,h+15);n.addColorStop(0,"#4A90E2"),n.addColorStop(1,"#2D5016"),i.fillStyle=n,i.beginPath(),i.arc(e+t.width/2,h+9,14,Math.PI,0),i.fill(),i.fillStyle="#7ED321",i.beginPath(),i.arc(e+t.width/2-3,h+6,4,0,Math.PI*2),i.fill(),i.fillStyle="#7ED321",i.font="bold 16px Arial",i.textAlign="center",i.strokeStyle="#2D5016",i.lineWidth=1,i.strokeText("‚ôª",e+t.width/2,h+30),i.fillText("‚ôª",e+t.width/2,h+30),i.fillStyle="#4A90E2";const d=Math.sin(t.animFrame)*1;i.fillRect(e+2,h+16+d,10,14),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(e+7,h+32+d,3,0,Math.PI*2),i.fill(),i.fillStyle="#4A90E2",i.fillRect(e+28,h+16-d,10,14),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(e+33,h+32-d,3,0,Math.PI*2),i.fill();const f=Math.sin(t.animFrame*1.5)*3,g=Math.sin(t.animFrame*1.5+Math.PI)*3;i.fillStyle="#4A90E2",i.fillRect(e+10,h+36,8,12+Math.abs(f)),i.fillRect(e+22,h+36,8,12+Math.abs(g)),i.fillStyle="#2D5016",i.fillRect(e+8,h+46+f,12,6),i.fillRect(e+20,h+46+g,12,6),i.fillStyle="white",i.beginPath(),i.arc(e+16,h+10,3,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(e+24,h+10,3,0,Math.PI*2),i.fill(),i.fillStyle="black",i.beginPath(),i.arc(e+16,h+10,1.5,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(e+24,h+10,1.5,0,Math.PI*2),i.fill(),i.strokeStyle="#8B4513",i.lineWidth=2,i.beginPath(),i.moveTo(e+13,h+6),i.lineTo(e+19,h+7),i.moveTo(e+21,h+7),i.lineTo(e+27,h+6),i.stroke(),t.carrying&&this.drawRealisticTrash(t.carrying,e+15,h-20,.8),i.globalAlpha=1}drawRealisticTrash(i,t,l,a=1){const e=this.ctx,h=i.width*a,s=i.height*a;switch(e.save(),e.translate(t+h/2,l+s/2),e.rotate(i.rotation||0),e.translate(-h/2,-s/2),e.fillStyle="rgba(45, 80, 22, 0.3)",e.fillRect(4,4,h,s),i.shape){case"bottle":this.drawBottle(e,0,0,h,s,i.color,i.detailColor);break;case"can":this.drawCan(e,0,0,h,s,i.color,i.detailColor);break;case"paper":this.drawPaper(e,0,0,h,s,i.color,i.detailColor);break;case"banana":this.drawBanana(e,0,0,h,s,i.color,i.detailColor);break;case"apple":this.drawApple(e,0,0,h,s,i.color,i.detailColor);break;case"leaves":this.drawLeaves(e,0,0,h,s,i.color,i.detailColor);break;case"wrapper":this.drawWrapper(e,0,0,h,s,i.color,i.detailColor);break;case"gum":this.drawGum(e,0,0,h,s,i.color,i.detailColor);break;case"bag":this.drawChipBag(e,0,0,h,s,i.color,i.detailColor);break}e.restore()}drawBottle(i,t,l,a,e,h,s){const o=i.createLinearGradient(t,l,t+a,l+e);o.addColorStop(0,this.lightenColor(h,.3)),o.addColorStop(.5,h),o.addColorStop(1,this.darkenColor(h,.3)),i.fillStyle=o,i.fillRect(t+a*.2,l+e*.3,a*.6,e*.6),i.fillStyle=this.darkenColor(h,.2),i.fillRect(t+a*.35,l,a*.3,e*.4),i.fillStyle=s,i.fillRect(t+a*.3,l,a*.4,e*.15),i.fillStyle="white",i.fillRect(t+a*.25,l+e*.4,a*.5,e*.2),i.fillStyle="rgba(255,255,255,0.6)",i.fillRect(t+a*.25,l+e*.35,a*.15,e*.3)}drawCan(i,t,l,a,e,h,s){const o=i.createRadialGradient(t+a/2,l+e/2,0,t+a/2,l+e/2,a/2);o.addColorStop(0,this.lightenColor(h,.4)),o.addColorStop(.7,h),o.addColorStop(1,this.darkenColor(h,.3)),i.fillStyle=o,i.fillRect(t,l+e*.1,a,e*.8),i.fillStyle=this.darkenColor(h,.4),i.fillRect(t,l,a,e*.15),i.fillRect(t,l+e*.85,a,e*.15),i.fillStyle=s,i.beginPath(),i.arc(t+a*.7,l+e*.1,a*.1,0,Math.PI*2),i.fill(),i.fillStyle=s,i.fillRect(t,l+e*.4,a,e*.2),i.fillStyle="rgba(255,255,255,0.5)",i.fillRect(t+a*.1,l+e*.2,a*.2,e*.6)}drawPaper(i,t,l,a,e,h,s){i.fillStyle=h,i.beginPath(),i.moveTo(t,l),i.lineTo(t+a*.8,l),i.lineTo(t+a,l+e*.2),i.lineTo(t+a,l+e),i.lineTo(t,l+e),i.closePath(),i.fill(),i.fillStyle=this.darkenColor(h,.2),i.beginPath(),i.moveTo(t+a*.8,l),i.lineTo(t+a,l+e*.2),i.lineTo(t+a*.8,l+e*.2),i.closePath(),i.fill(),i.strokeStyle=s,i.lineWidth=1;for(let o=0;o<4;o++)i.beginPath(),i.moveTo(t+a*.1,l+e*.3+o*e*.15),i.lineTo(t+a*.7,l+e*.3+o*e*.15),i.stroke()}drawBanana(i,t,l,a,e,h,s){i.fillStyle=h,i.beginPath(),i.moveTo(t+a*.2,l+e*.8),i.quadraticCurveTo(t+a*.1,l+e*.3,t+a*.4,l+e*.1),i.quadraticCurveTo(t+a*.7,l,t+a*.9,l+e*.2),i.quadraticCurveTo(t+a*.8,l+e*.4,t+a*.6,l+e*.6),i.quadraticCurveTo(t+a*.4,l+e*.9,t+a*.2,l+e*.8),i.fill(),i.fillStyle=s,i.beginPath(),i.arc(t+a*.3,l+e*.4,a*.08,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(t+a*.6,l+e*.3,a*.06,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(h,.3),i.fillRect(t+a*.35,l+e*.2,a*.15,e*.4)}drawApple(i,t,l,a,e,h,s){i.fillStyle=h,i.beginPath(),i.arc(t+a/2,l+e*.6,a*.4,0,Math.PI*2),i.fill(),i.fillStyle=this.darkenColor(h,.3),i.beginPath(),i.arc(t+a/2,l+e*.3,a*.15,0,Math.PI),i.fill(),i.fillStyle=s,i.fillRect(t+a*.48,l+e*.1,a*.04,e*.2),i.fillStyle=s,i.beginPath(),i.ellipse(t+a*.6,l+e*.15,a*.1,a*.05,Math.PI/4,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(h,.4),i.beginPath(),i.arc(t+a*.35,l+e*.45,a*.1,0,Math.PI*2),i.fill()}drawLeaves(i,t,l,a,e,h,s){for(let o=0;o<3;o++){const r=t+o*a*.2,n=l+o*e*.1;i.fillStyle=o===0?h:this.darkenColor(h,.2*o),i.beginPath(),i.ellipse(r+a*.3,n+e*.3,a*.25,e*.4,o*.3,0,Math.PI*2),i.fill(),i.strokeStyle=s,i.lineWidth=1,i.beginPath(),i.moveTo(r+a*.3,n+e*.1),i.lineTo(r+a*.3,n+e*.5),i.stroke()}}drawWrapper(i,t,l,a,e,h,s){i.fillStyle=h,i.beginPath(),i.moveTo(t,l+e*.2),i.lineTo(t+a*.3,l),i.lineTo(t+a*.7,l+e*.1),i.lineTo(t+a,l+e*.3),i.lineTo(t+a*.8,l+e*.7),i.lineTo(t+a*.9,l+e),i.lineTo(t+a*.2,l+e*.9),i.lineTo(t,l+e*.6),i.closePath(),i.fill(),i.fillStyle=this.lightenColor(h,.4),i.fillRect(t+a*.2,l+e*.2,a*.2,e*.15),i.fillRect(t+a*.6,l+e*.5,a*.15,e*.2),i.fillStyle=s,i.fillRect(t+a*.3,l+e*.4,a*.4,e*.1)}drawGum(i,t,l,a,e,h,s){i.fillStyle=h,i.beginPath(),i.arc(t+a*.3,l+e*.4,a*.25,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(t+a*.6,l+e*.6,a*.2,0,Math.PI*2),i.fill(),i.strokeStyle=this.lightenColor(h,.2),i.lineWidth=2,i.beginPath(),i.moveTo(t+a*.5,l+e*.2),i.quadraticCurveTo(t+a*.3,l+e*.1,t+a*.4,l),i.stroke()}drawChipBag(i,t,l,a,e,h,s){const o=i.createLinearGradient(t,l,t+a,l);o.addColorStop(0,this.lightenColor(h,.2)),o.addColorStop(.5,h),o.addColorStop(1,this.darkenColor(h,.2)),i.fillStyle=o,i.beginPath(),i.moveTo(t+a*.1,l),i.lineTo(t+a*.9,l),i.lineTo(t+a*.8,l+e),i.lineTo(t+a*.2,l+e),i.closePath(),i.fill(),i.fillStyle=s,i.fillRect(t+a*.2,l+e*.3,a*.6,e*.4),i.strokeStyle=this.darkenColor(h,.3),i.lineWidth=1;for(let r=0;r<3;r++)i.beginPath(),i.moveTo(t+a*.1,l+e*.2+r*e*.3),i.lineTo(t+a*.9,l+e*.25+r*e*.3),i.stroke()}draw3DTrash(i,t,l,a=1){const e=this.ctx,h=i.width*a,s=i.height*a,o=8*a;e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(t+o/2,l+s+o/2,h,s/2),e.fillStyle=this.lightenColor(i.color,.3),e.beginPath(),e.moveTo(t,l),e.lineTo(t+h,l),e.lineTo(t+h+o,l-o),e.lineTo(t+o,l-o),e.closePath(),e.fill();const r=e.createLinearGradient(t,l,t+h,l+s);r.addColorStop(0,i.color),r.addColorStop(1,this.darkenColor(i.color,.2)),e.fillStyle=r,e.fillRect(t,l,h,s),e.fillStyle=this.darkenColor(i.color,.4),e.beginPath(),e.moveTo(t+h,l),e.lineTo(t+h+o,l-o),e.lineTo(t+h+o,l+s-o),e.lineTo(t+h,l+s),e.closePath(),e.fill(),e.fillStyle="rgba(255,255,255,0.4)",e.fillRect(t+2,l+2,h/3,s/3),e.fillStyle="white",e.font=`bold ${Math.floor(10*a)}px Arial`,e.textAlign="center",e.strokeStyle="black",e.lineWidth=1,e.strokeText(i.item,t+h/2,l+s/2+3),e.fillText(i.item,t+h/2,l+s/2+3),i.type==="recycle"?(e.fillStyle="#00AA00",e.font=`${Math.floor(8*a)}px Arial`,e.fillText("‚ôª",t+h-6,l+10)):i.type==="compost"&&(e.fillStyle="#88AA00",e.font=`${Math.floor(8*a)}px Arial`,e.fillText("üçÉ",t+h-6,l+10))}lightenColor(i,t){const l=parseInt(i.slice(1),16),a=Math.min(255,Math.floor((l>>16)+(255-(l>>16))*t)),e=Math.min(255,Math.floor((l>>8&255)+(255-(l>>8&255))*t)),h=Math.min(255,Math.floor((l&255)+(255-(l&255))*t));return`rgb(${a},${e},${h})`}drawBin(i){const t=this.ctx,l=t.createLinearGradient(i.x,0,i.x+i.width,0);l.addColorStop(0,i.color),l.addColorStop(.3,i.color),l.addColorStop(.7,this.darkenColor(i.color,.3)),l.addColorStop(1,this.darkenColor(i.color,.5)),t.fillStyle=l,t.fillRect(i.x,i.y,i.width,i.height),t.fillStyle=this.darkenColor(i.color,.2),t.fillRect(i.x-5,i.y-8,i.width+10,10),t.fillStyle="#666",t.fillRect(i.x+i.width/2-3,i.y-12,6,8),t.fillStyle="white",t.font="bold 32px Arial",t.textAlign="center",i.type==="recycle"?t.fillText("‚ôª",i.x+i.width/2,i.y+i.height/2+8):i.type==="compost"?t.fillText("üçé",i.x+i.width/2,i.y+i.height/2+8):t.fillText("üóë",i.x+i.width/2,i.y+i.height/2+8),t.fillStyle="white",t.font="bold 16px Arial",t.fillText(i.label,i.x+i.width/2,i.y-15)}drawObstacle(i){const t=this.ctx,l=15;switch(t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(i.x+l/2,i.y+i.height+l/2,i.width,i.height/3),i.type){case"slide":this.drawSlide(t,i,l);break;case"roundabout":this.drawRoundabout(t,i,l);break;case"seesaw":this.drawSeesaw(t,i,l);break;case"swing":this.drawSwing(t,i,l);break;case"tree":this.drawTree(t,i,l);break;case"bench":this.drawBench(t,i,l);break}}drawSlide(i,t,l){i.fillStyle=this.darkenColor(t.color,.3),i.fillRect(t.x+l,t.y+l,t.width,t.height),i.fillStyle=t.color,i.fillRect(t.x,t.y,t.width,t.height),i.fillStyle=this.darkenColor(t.color,.5),i.beginPath(),i.moveTo(t.x+t.width,t.y),i.lineTo(t.x+t.width+l,t.y+l),i.lineTo(t.x+t.width+l,t.y+t.height+l),i.lineTo(t.x+t.width,t.y+t.height),i.closePath(),i.fill(),i.fillStyle=this.lightenColor(t.color,.2),i.beginPath(),i.moveTo(t.x+10,t.y+10),i.lineTo(t.x+t.width-10,t.y+t.height-10),i.lineTo(t.x+t.width-5,t.y+t.height-10),i.lineTo(t.x+15,t.y+10),i.closePath(),i.fill()}drawRoundabout(i,t,l){const a=t.x+t.width/2,e=t.y+t.height/2,h=t.width/2;i.fillStyle=this.darkenColor(t.color,.5),i.beginPath(),i.arc(a+l/2,e+l/2,h,0,Math.PI*2),i.fill(),i.fillStyle=t.color,i.beginPath(),i.arc(a,e,h,0,Math.PI*2),i.fill(),i.fillStyle=this.darkenColor(t.color,.3),i.beginPath(),i.arc(a,e,h/4,0,Math.PI*2),i.fill(),i.strokeStyle="#666",i.lineWidth=4;for(let s=0;s<4;s++){const o=s*Math.PI/2,r=a+Math.cos(o)*h*.7,n=e+Math.sin(o)*h*.7;i.beginPath(),i.arc(r,n,3,0,Math.PI*2),i.stroke()}}drawSeesaw(i,t,l){const a=t.x+t.width/2,e=t.y+t.height/2;i.fillStyle=this.darkenColor(t.color,.4),i.beginPath(),i.moveTo(a-10,e),i.lineTo(a+10,e),i.lineTo(a,t.y+t.height),i.closePath(),i.fill(),i.fillStyle=t.color,i.fillRect(t.x,t.y,t.width,t.height),i.fillStyle=this.darkenColor(t.color,.3),i.fillRect(t.x+l,t.y+l,t.width,t.height/3),i.fillStyle=this.lightenColor(t.color,.2),i.fillRect(t.x+5,t.y-5,15,10),i.fillRect(t.x+t.width-20,t.y-5,15,10)}drawSwing(i,t,l){i.strokeStyle=t.color,i.lineWidth=6,i.beginPath(),i.moveTo(t.x,t.y+t.height),i.lineTo(t.x+t.width/2,t.y),i.lineTo(t.x+t.width,t.y+t.height),i.stroke(),i.beginPath(),i.moveTo(t.x+5,t.y+10),i.lineTo(t.x+t.width-5,t.y+10),i.stroke(),i.strokeStyle="#666",i.lineWidth=2;const a=t.x+t.width/2;i.beginPath(),i.moveTo(a-3,t.y+10),i.lineTo(a-3,t.y+t.height-10),i.moveTo(a+3,t.y+10),i.lineTo(a+3,t.y+t.height-10),i.stroke(),i.fillStyle="#8B4513",i.fillRect(a-8,t.y+t.height-15,16,6)}drawTree(i,t,l){const a=t.x+t.width/2,e=t.width*.3,h=t.height*.6,s=t.width*.4;i.fillStyle="rgba(0,0,0,0.3)",i.beginPath(),i.arc(a+l/2,t.y+t.height+l/2,s*1.2,0,Math.PI*2),i.fill(),i.fillStyle="#8B4513",i.fillRect(a-e/2,t.y+t.height-h,e,h),i.fillStyle=this.darkenColor("#8B4513",.3),i.fillRect(a-e/2+l/2,t.y+t.height-h+l/2,e/2,h),i.fillStyle=this.darkenColor(t.color,.3),i.beginPath(),i.arc(a+l/3,t.y+s+l/3,s,0,Math.PI*2),i.fill(),i.fillStyle=t.color,i.beginPath(),i.arc(a,t.y+s,s,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(t.color,.3),i.beginPath(),i.arc(a-s/3,t.y+s/2,s/2,0,Math.PI*2),i.fill()}drawBench(i,t,l){i.fillStyle=t.color,i.fillRect(t.x,t.y,t.width,t.height),i.fillStyle=this.darkenColor(t.color,.4),i.beginPath(),i.moveTo(t.x+t.width,t.y),i.lineTo(t.x+t.width+l,t.y+l),i.lineTo(t.x+t.width+l,t.y+t.height+l),i.lineTo(t.x+t.width,t.y+t.height),i.closePath(),i.fill();const a=8,e=t.height+10;i.fillStyle=this.darkenColor(t.color,.2),i.fillRect(t.x+5,t.y+t.height,a,e),i.fillRect(t.x+15,t.y+t.height,a,e),i.fillRect(t.x+t.width-23,t.y+t.height,a,e),i.fillRect(t.x+t.width-13,t.y+t.height,a,e),i.fillStyle=t.color,i.fillRect(t.x,t.y-20,t.width,15)}drawTurkey(i){const t=this.ctx;i.animFrame=(i.animFrame||0)+.2,i.animFrame>=8&&(i.animFrame=0);const l=Math.sin(i.animFrame*2)*(i.chasing?3:1),a=1+(i.aggressionLevel||0)*.2;t.fillStyle="rgba(0,0,0,0.25)",t.beginPath(),t.ellipse(i.x+i.width/2,i.y+i.height+5,i.width/2*a,8,0,0,Math.PI*2),t.fill();let e=i.chasing?"#AA0000":"#8B4513";i.aggressionLevel>.5&&(e=i.chasing?"#FF0000":"#A0522D"),t.fillStyle=e,t.beginPath(),t.ellipse(i.x+i.width/2,i.y+i.height/2+l,18*a,15*a,0,0,Math.PI*2),t.fill();const h=i.chasing?7:5,s=i.chasing?.4:.3;for(let p=0;p<h;p++){const c=(p-h/2)*s,y=i.chasing?20:16,S=i.x+i.width/2-Math.cos(c)*15,T=i.y+i.height/2-Math.sin(c)*10+l,v=["#654321","#8B4513","#A0522D"];t.fillStyle=v[p%3],t.save(),t.translate(S,T),t.rotate(c),t.fillRect(-3,-y/2,6,y),t.fillStyle=i.chasing?"#FF4444":"#D2691E",t.fillRect(-2,-y/2,4,4),t.restore()}t.fillStyle="#A0522D";const o=i.chasing?Math.sin(i.animFrame*4)*3:0;t.save(),t.translate(i.x+8,i.y+12+l),t.rotate(o*.1),t.fillRect(0,0,12,16),t.restore(),t.save(),t.translate(i.x+25,i.y+12+l),t.rotate(-o*.1),t.fillRect(0,0,12,16),t.restore();const r=i.chasing?16:12;t.fillStyle="#D2691E",t.fillRect(i.x+15,i.y+5+l,8,r);const n=i.chasing?8:6;t.fillStyle=e,t.beginPath(),t.arc(i.x+19,i.y+8+l,n,0,Math.PI*2),t.fill(),t.fillStyle="#F5A623",i.chasing?(t.beginPath(),t.moveTo(i.x+26,i.y+6+l),t.lineTo(i.x+32,i.y+4+l),t.lineTo(i.x+30,i.y+8+l),t.fill(),t.beginPath(),t.moveTo(i.x+26,i.y+10+l),t.lineTo(i.x+32,i.y+12+l),t.lineTo(i.x+30,i.y+8+l),t.fill()):(t.beginPath(),t.moveTo(i.x+26,i.y+8+l),t.lineTo(i.x+30,i.y+6+l),t.lineTo(i.x+26,i.y+10+l),t.fill()),t.fillStyle=i.chasing?"#FF0000":"#FF6B6B",t.beginPath(),t.arc(i.x+19,i.y+14+l,i.chasing?4:3,0,Math.PI),t.fill(),t.fillStyle="white",t.beginPath(),t.arc(i.x+21,i.y+6+l,2.5,0,Math.PI*2),t.fill(),t.fillStyle=i.chasing?"#FF0000":"black",t.beginPath(),t.arc(i.x+22,i.y+6+l,i.chasing?2:1,0,Math.PI*2),t.fill(),i.chasing&&(t.strokeStyle="#AA0000",t.lineWidth=2,t.beginPath(),t.moveTo(i.x+18,i.y+3+l),t.lineTo(i.x+24,i.y+5+l),t.stroke()),t.fillStyle="#F5A623";const d=i.chasing?4:2,f=Math.sin(i.animFrame*d)*2,g=Math.sin(i.animFrame*d+Math.PI)*2;if(t.fillRect(i.x+12,i.y+i.height-5+f,4,10),t.fillRect(i.x+22,i.y+i.height-5+g,4,10),t.strokeStyle="#F5A623",t.lineWidth=i.chasing?3:2,t.beginPath(),t.moveTo(i.x+10,i.y+i.height+5+f),t.lineTo(i.x+18,i.y+i.height+5+f),i.chasing&&(t.moveTo(i.x+8,i.y+i.height+3+f),t.lineTo(i.x+10,i.y+i.height+5+f)),t.stroke(),t.beginPath(),t.moveTo(i.x+20,i.y+i.height+5+g),t.lineTo(i.x+28,i.y+i.height+5+g),i.chasing&&(t.moveTo(i.x+28,i.y+i.height+3+g),t.lineTo(i.x+30,i.y+i.height+5+g)),t.stroke(),i.chasing&&Math.random()<.3)for(let p=0;p<3;p++)this.particles.push({x:i.x+i.width/2+(Math.random()-.5)*10,y:i.y+i.height+5,vx:(Math.random()-.5)*2,vy:Math.random()*-2,life:15,maxLife:15,color:"#D2B48C",size:Math.random()*3+1,type:"dust"})}darkenColor(i,t){const l=parseInt(i.slice(1),16),a=Math.floor((l>>16)*(1-t)),e=Math.floor((l>>8&255)*(1-t)),h=Math.floor((l&255)*(1-t));return`rgb(${a},${e},${h})`}lightenColor(i,t){const l=parseInt(i.slice(1),16),a=Math.min(255,Math.floor((l>>16)+(255-(l>>16))*t)),e=Math.min(255,Math.floor((l>>8&255)+(255-(l>>8&255))*t)),h=Math.min(255,Math.floor((l&255)+(255-(l&255))*t));return`rgb(${a},${e},${h})`}isColliding(i,t){return i.x<t.x+t.width&&i.x+i.width>t.x&&i.y<t.y+t.height&&i.y+i.height>t.y}render(){const i=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);i.addColorStop(0,"#90EE90"),i.addColorStop(.5,"#7ED321"),i.addColorStop(1,"#5CB85C"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawPlayground(),this.obstacles.forEach(t=>{this.drawObstacle(t)}),this.bins.forEach(t=>{this.drawBin(t)}),this.trash.forEach(t=>{this.drawRealisticTrash(t,t.x,t.y)}),this.enemies.forEach(t=>{this.drawTurkey(t)}),this.drawPlayer(),this.particles.forEach(t=>{this.ctx.save(),this.ctx.globalAlpha=t.alpha||1,t.type==="scoreText"?(this.ctx.fillStyle=t.color,this.ctx.font=`bold ${t.size}px Arial`,this.ctx.textAlign="center",this.ctx.strokeStyle="#2D5016",this.ctx.lineWidth=2,this.ctx.strokeText(t.text,t.x,t.y),this.ctx.fillText(t.text,t.x,t.y)):(this.ctx.fillStyle=t.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,Math.PI*2),this.ctx.fill()),this.ctx.restore()})}drawPlayground(){this.ctx.fillStyle="#8B4513",this.ctx.fillRect(600,400,10,100),this.ctx.fillRect(700,400,10,100),this.ctx.fillRect(590,400,130,10),this.ctx.fillStyle="#FFD700",this.ctx.fillRect(500,100,80,20),this.ctx.fillRect(500,120,20,80),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(300,450,15,60),this.ctx.fillRect(750,50,15,80),this.ctx.fillStyle="#228B22",this.ctx.beginPath(),this.ctx.arc(307,440,30,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(757,40,35,0,Math.PI*2),this.ctx.fill()}updateUI(){document.getElementById("score").textContent=this.score,document.getElementById("carrying").textContent=this.player.carrying?this.player.carrying.item:"Nothing"}startTimer(){this.timerInterval=setInterval(()=>{this.timeLeft--,document.getElementById("timer").textContent=this.timeLeft,this.timeLeft<=0&&this.endGame()},1e3)}endGame(){this.gameState="gameOver",clearInterval(this.timerInterval),document.getElementById("finalScore").textContent=this.score,document.getElementById("gameOver").style.display="block"}submitScore(){const i=document.getElementById("playerName").value.trim()||"Anonymous",t=this.getStoredScores();t.push({name:i,score:this.score,date:new Date().toLocaleDateString()}),t.sort((l,a)=>a.score-l.score),t.splice(10),localStorage.setItem("recycleGameScores",JSON.stringify(t)),this.displayLeaderboard()}loadLeaderboard(){this.displayLeaderboard()}getStoredScores(){const i=localStorage.getItem("recycleGameScores");return i?JSON.parse(i):[]}displayLeaderboard(){const i=this.getStoredScores(),t=document.getElementById("scores");t.innerHTML=i.slice(0,5).map((l,a)=>`${a+1}. ${l.name}: ${l.score}`).join("<br>")}restart(){this.gameState="playing",this.timeLeft=this.gameTime,this.score=0,this.player.x=400,this.player.y=300,this.player.carrying=null,this.player.vx=0,this.player.vy=0,this.trash=[],this.enemies=[],this.spawnTrash(),this.spawnEnemies(),document.getElementById("gameOver").style.display="none",document.getElementById("playerName").value="",this.updateUI(),this.startTimer()}gameLoop(){this.gameState==="playing"&&(this.updatePlayer(),this.updateEnemies(),this.updateParticles(),this.checkCollisions()),this.render(),requestAnimationFrame(()=>this.gameLoop())}}window.addEventListener("load",()=>{window.game=new M});
