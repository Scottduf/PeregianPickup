(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))t(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function e(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function t(a){if(a.ep)return;a.ep=!0;const l=e(a);fetch(a.href,l)}})();const M={development:{apiUrl:"http://localhost:3001/api"},production:{apiUrl:"https://your-backend-url.herokuapp.com/api"}},w=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",P=w?"development":"production",C=M[P];class u{constructor(){this.canvas=document.getElementById("gameCanvas"),this.ctx=this.canvas.getContext("2d"),this.gameState="playing",this.gameTime=60,this.timeLeft=this.gameTime,this.score=0,this.gameSpeed=1,this.player={x:400,y:300,width:40,height:40,speed:4,vx:0,vy:0,carrying:null,color:"#4A90E2",direction:"down",animFrame:0,animSpeed:.2,immune:!0,immuneTimer:180},this.touches={},this.setupTouchControls(),this.trash=[],this.bins=[],this.enemies=[],this.particles=[],this.obstacles=[],this.soundEffects={},this.initializeSounds(),this.initializeBins(),this.initializeObstacles(),this.spawnTrash(),this.spawnEnemies(),this.apiUrl=C.apiUrl,this.loadLeaderboard(),this.gameLoop(),this.startTimer()}initializeSounds(){this.audioContext=null;try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch{console.log("Audio not supported")}}playSound(i,e,t="sine",a=.1){if(this.audioContext)try{const l=this.audioContext.createOscillator(),s=this.audioContext.createGain();l.connect(s),s.connect(this.audioContext.destination),l.frequency.setValueAtTime(i,this.audioContext.currentTime),l.type=t,s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+.01),s.gain.exponentialRampToValueAtTime(.001,this.audioContext.currentTime+e),l.start(this.audioContext.currentTime),l.stop(this.audioContext.currentTime+e)}catch{console.log("Sound playback failed")}}playBinSound(i=!0){i?(this.playSound(523,.1,"sine",.15),setTimeout(()=>this.playSound(659,.1,"sine",.15),50),setTimeout(()=>this.playSound(784,.15,"sine",.15),100)):this.playSound(392,.2,"square",.1)}playTurkeySound(){this.playSound(200,.05,"sawtooth",.2),setTimeout(()=>this.playSound(180,.05,"sawtooth",.15),60),setTimeout(()=>this.playSound(220,.05,"sawtooth",.15),120),setTimeout(()=>this.playSound(160,.1,"sawtooth",.1),180)}setupTouchControls(){this.canvas.addEventListener("touchstart",i=>{i.preventDefault();const e=i.touches[0],t=this.canvas.getBoundingClientRect(),a=e.clientX-t.left,l=e.clientY-t.top;this.movePlayerTowards(a,l)}),this.canvas.addEventListener("touchmove",i=>{i.preventDefault();const e=i.touches[0],t=this.canvas.getBoundingClientRect(),a=e.clientX-t.left,l=e.clientY-t.top;this.movePlayerTowards(a,l)}),this.canvas.addEventListener("click",i=>{const e=this.canvas.getBoundingClientRect(),t=i.clientX-e.left,a=i.clientY-e.top;this.movePlayerTowards(t,a)}),document.addEventListener("keydown",i=>{this.handleKeyboard(i.key)})}movePlayerTowards(i,e){const t=i-(this.player.x+this.player.width/2),a=e-(this.player.y+this.player.height/2),l=Math.sqrt(t*t+a*a);l>5?(this.player.vx=t/l*this.player.speed,this.player.vy=a/l*this.player.speed):(this.player.vx=0,this.player.vy=0)}handleKeyboard(i){const e=this.player.speed;switch(i){case"ArrowUp":case"w":this.player.vy=-e;break;case"ArrowDown":case"s":this.player.vy=e;break;case"ArrowLeft":case"a":this.player.vx=-e;break;case"ArrowRight":case"d":this.player.vx=e;break}}initializeBins(){this.bins=[{x:50,y:50,width:60,height:80,type:"recycle",color:"#4A90E2",label:"Recycle"},{x:50,y:200,width:60,height:80,type:"compost",color:"#7ED321",label:"Compost"},{x:50,y:350,width:60,height:80,type:"trash",color:"#2D5016",label:"Trash"}]}initializeObstacles(){this.obstacles=[{x:300,y:150,width:80,height:100,type:"slide",color:"#FF6B6B"},{x:500,y:300,width:60,height:60,type:"roundabout",color:"#4ECDC4"},{x:200,y:250,width:50,height:80,type:"tree",color:"#228B22"},{x:600,y:150,width:55,height:85,type:"tree",color:"#32CD32"},{x:450,y:100,width:80,height:30,type:"bench",color:"#8B4513"}]}spawnTrash(){const i=[{type:"recycle",color:"#4A90E2",items:[{name:"bottle",shape:"bottle",color:"#87CEEB",detail:"#4169E1"},{name:"can",shape:"can",color:"#C0C0C0",detail:"#FF6347"},{name:"paper",shape:"paper",color:"#F5F5DC",detail:"#000080"}]},{type:"compost",color:"#7ED321",items:[{name:"banana",shape:"banana",color:"#FFD700",detail:"#8B4513"},{name:"apple",shape:"apple",color:"#FF6347",detail:"#228B22"},{name:"leaves",shape:"leaves",color:"#228B22",detail:"#8B4513"}]},{type:"trash",color:"#2D5016",items:[{name:"wrapper",shape:"wrapper",color:"#FF69B4",detail:"#8A2BE2"},{name:"gum",shape:"gum",color:"#FF1493",detail:"#B22222"},{name:"chip_bag",shape:"bag",color:"#FFD700",detail:"#FF4500"}]}];for(let e=0;e<18;e++){const t=i[Math.floor(Math.random()*i.length)],a=t.items[Math.floor(Math.random()*t.items.length)];let l=0,s=!1,o;for(;!s&&l<30;){o={x:Math.random()*(this.canvas.width-200)+150,y:Math.random()*(this.canvas.height-100)+50,width:24,height:24,type:t.type,item:a.name,shape:a.shape,color:a.color,detailColor:a.detail,rotation:Math.random()*.4-.2},s=!0;for(let h of[...this.obstacles,...this.bins])if(this.isColliding(o,h)){s=!1;break}l++}s&&this.trash.push(o)}}spawnEnemies(){for(let i=0;i<4;i++)this.enemies.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,width:40,height:40,speed:2,chaseSpeed:3.5,color:"#8B4513",chasing:!1,alertDistance:150,aggressionLevel:0,lastPlayerDistance:999,animFrame:Math.random()*4})}updatePlayer(){if(this.player.immune&&(this.player.immuneTimer--,this.player.immuneTimer<=0&&(this.player.immune=!1)),this.player.vx||this.player.vy){const i=this.player.x,e=this.player.y;this.player.x+=this.player.vx,this.player.y+=this.player.vy;let t=!1;for(let a of this.obstacles)if(this.isColliding(this.player,a)){this.player.x=i,this.player.y=e,this.player.vx=0,this.player.vy=0,t=!0;break}if(!t){for(let a of this.bins)if(this.isColliding(this.player,a)){const l=Math.min(this.player.x+this.player.width-a.x,a.x+a.width-this.player.x),s=Math.min(this.player.y+this.player.height-a.y,a.y+a.height-this.player.y);if(l>10&&s>10){this.player.x=i,this.player.y=e,this.player.vx=0,this.player.vy=0,t=!0;break}}}t||(this.player.vx*=.9,this.player.vy*=.9,Math.abs(this.player.vx)<.1&&(this.player.vx=0),Math.abs(this.player.vy)<.1&&(this.player.vy=0))}this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.player.y=Math.max(0,Math.min(this.canvas.height-this.player.height,this.player.y))}updateEnemies(){this.enemies.forEach(i=>{i.wanderAngle||(i.wanderAngle=Math.random()*Math.PI*2),i.wanderTimer||(i.wanderTimer=0),i.alertDistance||(i.alertDistance=150),i.aggressionLevel||(i.aggressionLevel=0),i.satisfiedTimer||(i.satisfiedTimer=0),i.satisfiedTimer>0&&(i.satisfiedTimer--,i.aggressionLevel=Math.max(i.aggressionLevel-.05,0));const e=Math.sqrt(Math.pow(this.player.x-i.x,2)+Math.pow(this.player.y-i.y,2));if(this.player.carrying&&!this.player.immune&&i.satisfiedTimer<=0?i.aggressionLevel=Math.min(i.aggressionLevel+.01,.6):i.aggressionLevel=Math.max(i.aggressionLevel-.02,0),this.player.carrying&&!this.player.immune&&e<i.alertDistance&&i.aggressionLevel>.3&&i.satisfiedTimer<=0){i.chasing=!0;const t=this.player.x-i.x,a=this.player.y-i.y;if(Math.sqrt(t*t+a*a)>0){const s=i.chaseSpeed*(.7+i.aggressionLevel*.3),o=this.player.x+(this.player.vx||0)*10,h=this.player.y+(this.player.vy||0)*10,r=o-i.x,n=h-i.y,d=Math.sqrt(r*r+n*n);d>0&&(i.x+=r/d*s,i.y+=n/d*s),i.x+=(Math.random()-.5)*1,i.y+=(Math.random()-.5)*1}Math.random()<.005&&this.playTurkeySound()}else if(!this.player.carrying&&i.chasing&&e<80){i.chasing=!1,i.fleeing=!0,i.fleeTimer=90;const t=i.x-this.player.x,a=i.y-this.player.y,l=Math.sqrt(t*t+a*a);l>0&&(i.x+=t/l*i.speed*2.5,i.y+=a/l*i.speed*2.5)}else if(i.fleeing&&i.fleeTimer>0){i.fleeTimer--;const t=i.x-this.player.x,a=i.y-this.player.y,l=Math.sqrt(t*t+a*a);l>0&&(i.x+=t/l*i.speed*1.5,i.y+=a/l*i.speed*1.5),i.fleeTimer<=0&&(i.fleeing=!1)}else{i.chasing=!1,i.fleeing=!1,i.wanderTimer++,i.wanderTimer>40+Math.random()*80&&(i.wanderAngle=Math.random()*Math.PI*2,i.wanderTimer=0);const t=i.speed*.8;i.x+=Math.cos(i.wanderAngle)*t,i.y+=Math.sin(i.wanderAngle)*t;const a=50;i.x<a&&(i.wanderAngle=Math.random()*Math.PI-Math.PI/2),i.x>this.canvas.width-a&&(i.wanderAngle=Math.random()*Math.PI+Math.PI/2),i.y<a&&(i.wanderAngle=Math.random()*Math.PI),i.y>this.canvas.height-a&&(i.wanderAngle=Math.random()*Math.PI+Math.PI)}for(let t of[...this.obstacles,...this.bins])if(this.isColliding(i,t)){const a=i.x+i.width/2-(t.x+t.width/2),l=i.y+i.height/2-(t.y+t.height/2);i.wanderAngle=Math.atan2(l,a)+(Math.random()-.5)*Math.PI/3;const s=Math.sqrt(a*a+l*l);s>0&&(i.x+=a/s*15,i.y+=l/s*15);break}i.x=Math.max(0,Math.min(this.canvas.width-i.width,i.x)),i.y=Math.max(0,Math.min(this.canvas.height-i.height,i.y)),i.lastPlayerDistance=e})}checkCollisions(){this.player.carrying||this.trash.forEach((i,e)=>{this.isColliding(this.player,i)&&(this.player.carrying=i,this.trash.splice(e,1),this.updateUI(),this.playSound(440,.1,"sine",.1))}),this.player.carrying&&this.bins.forEach(i=>{this.isColliding(this.player,i)&&(this.player.carrying.type===i.type?(this.score+=10,this.createSuccessEffect(i.x+i.width/2,i.y+i.height/2),this.playBinSound(!0)):(this.score+=1,this.createFailEffect(i.x+i.width/2,i.y+i.height/2),this.playBinSound(!1)),this.player.carrying=null,this.updateUI(),Math.random()<.4&&this.spawnNewTrash())}),this.player.carrying&&!this.player.immune&&this.enemies.forEach(i=>{if(this.isColliding(this.player,i)){this.createPeckEffect(this.player.x+this.player.width/2,this.player.y+this.player.height/2),this.playTurkeySound(),this.player.carrying=null,this.updateUI(),this.player.immune=!0,this.player.immuneTimer=90;const e=i.x-this.player.x,t=i.y-this.player.y,a=Math.sqrt(e*e+t*t);a>0&&(i.x+=e/a*40,i.y+=t/a*40),i.aggressionLevel=0,i.chasing=!1,i.satisfiedTimer=180,this.cameraShake=5}})}createSuccessEffect(i,e){for(let t=0;t<15;t++)this.particles.push({x:i,y:e,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8-2,life:30,maxLife:30,color:"#00FF00",size:Math.random()*4+2,type:"success"});this.particles.push({x:i,y:e-20,vx:0,vy:-2,life:60,maxLife:60,color:"#00FF00",size:16,type:"scoreText",text:"+10"})}createFailEffect(i,e){for(let t=0;t<8;t++)this.particles.push({x:i,y:e,vx:(Math.random()-.5)*6,vy:(Math.random()-.5)*6,life:20,maxLife:20,color:"#FF6600",size:Math.random()*3+1,type:"fail"});this.particles.push({x:i,y:e-20,vx:0,vy:-1,life:40,maxLife:40,color:"#FF6600",size:14,type:"scoreText",text:"+1"})}createPeckEffect(i,e){for(let t=0;t<15;t++)this.particles.push({x:i,y:e,vx:(Math.random()-.5)*8,vy:(Math.random()-.5)*8,life:30,maxLife:30,color:Math.random()>.5?"#D2691E":"#8B4513",size:Math.random()*4+2,type:"feather"});this.particles.push({x:i,y:e-15,vx:0,vy:-2,life:60,maxLife:60,color:"#F5A623",size:16,type:"scoreText",text:"PECKED!"})}createImpactEffect(i,e){for(let t=0;t<20;t++)this.particles.push({x:i,y:e,vx:(Math.random()-.5)*12,vy:(Math.random()-.5)*12,life:25,maxLife:25,color:"#FF0000",size:Math.random()*5+2,type:"impact"});this.particles.push({x:i,y:e-15,vx:0,vy:-3,life:45,maxLife:45,color:"#FF0000",size:18,type:"scoreText",text:"CAUGHT!"})}updateParticles(){this.particles=this.particles.filter(i=>(i.x+=i.vx,i.y+=i.vy,i.life--,i.type!=="scoreText"&&(i.vy+=.2),i.alpha=i.life/i.maxLife,i.life>0))}spawnNewTrash(){const i=[{type:"recycle",color:"#2196F3",items:["bottle","can","paper"]},{type:"compost",color:"#FF9800",items:["apple","banana","leaves"]},{type:"trash",color:"#F44336",items:["wrapper","gum","broken_toy"]}],e=i[Math.floor(Math.random()*i.length)],t=e.items[Math.floor(Math.random()*e.items.length)];let a=0,l=!1,s;for(;!l&&a<20;){s={x:Math.random()*(this.canvas.width-200)+150,y:Math.random()*(this.canvas.height-100)+50,width:20,height:20,type:e.type,item:t,color:e.color},l=!0;for(let o of[...this.obstacles,...this.bins])if(this.isColliding(s,o)){l=!1;break}a++}l&&this.trash.push(s)}drawPlayer(){const i=this.ctx,e=this.player;let t=0,a=0;this.cameraShake&&this.cameraShake>0&&(t=(Math.random()-.5)*this.cameraShake,a=(Math.random()-.5)*this.cameraShake,this.cameraShake--);const l=e.x+t,s=e.y+a;e.immune&&Math.floor(e.immuneTimer/6)%2===0&&(i.globalAlpha=.5),(e.vx!==0||e.vy!==0)&&(e.animFrame+=e.animSpeed,e.animFrame>=8&&(e.animFrame=0),Math.abs(e.vx)>Math.abs(e.vy)?e.direction=e.vx>0?"right":"left":e.vy!==0&&(e.direction=e.vy>0?"down":"up")),i.fillStyle="rgba(0,0,0,0.3)",i.beginPath(),i.ellipse(l+e.width/2,s+e.height+8,e.width/2+2,10,0,0,Math.PI*2),i.fill(),i.fillStyle="#F5A623";const o=Math.sin(e.animFrame*.5)*3,h=Math.sin(e.animFrame*.8)*2;i.beginPath(),i.moveTo(l-2+h,s+8),i.quadraticCurveTo(l-8+o,s+20,l-1+h,s+32),i.quadraticCurveTo(l+5+o,s+35,l+8+h,s+30),i.quadraticCurveTo(l+6,s+15,l+3,s+8),i.closePath(),i.fill();const r=i.createLinearGradient(l,s,l+e.width,s+25);r.addColorStop(0,"#7ED321"),r.addColorStop(.5,"#4A90E2"),r.addColorStop(1,"#2D5016"),i.fillStyle=r,i.fillRect(l+6,s+14,28,22),i.fillStyle="#2D5016",i.fillRect(l+10,s+18,8,6),i.fillRect(l+22,s+18,8,6),i.fillStyle="#F5A623",i.fillRect(l+8,s+28,24,4),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(l+e.width/2,s+12,14,0,Math.PI*2),i.fill();const n=i.createLinearGradient(l,s,l+e.width,s+15);n.addColorStop(0,"#4A90E2"),n.addColorStop(1,"#2D5016"),i.fillStyle=n,i.beginPath(),i.arc(l+e.width/2,s+9,14,Math.PI,0),i.fill(),i.fillStyle="#7ED321",i.beginPath(),i.arc(l+e.width/2-3,s+6,4,0,Math.PI*2),i.fill(),i.fillStyle="#7ED321",i.font="bold 16px Arial",i.textAlign="center",i.strokeStyle="#2D5016",i.lineWidth=1,i.strokeText("‚ôª",l+e.width/2,s+30),i.fillText("‚ôª",l+e.width/2,s+30),i.fillStyle="#4A90E2";const d=Math.sin(e.animFrame)*1;i.fillRect(l+2,s+16+d,10,14),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(l+7,s+32+d,3,0,Math.PI*2),i.fill(),i.fillStyle="#4A90E2",i.fillRect(l+28,s+16-d,10,14),i.fillStyle="#FFDBAC",i.beginPath(),i.arc(l+33,s+32-d,3,0,Math.PI*2),i.fill();const f=Math.sin(e.animFrame*1.5)*3,g=Math.sin(e.animFrame*1.5+Math.PI)*3;i.fillStyle="#4A90E2",i.fillRect(l+10,s+36,8,12+Math.abs(f)),i.fillRect(l+22,s+36,8,12+Math.abs(g)),i.fillStyle="#2D5016",i.fillRect(l+8,s+46+f,12,6),i.fillRect(l+20,s+46+g,12,6),i.fillStyle="white",i.beginPath(),i.arc(l+16,s+10,3,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(l+24,s+10,3,0,Math.PI*2),i.fill(),i.fillStyle="black",i.beginPath(),i.arc(l+16,s+10,1.5,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(l+24,s+10,1.5,0,Math.PI*2),i.fill(),i.strokeStyle="#8B4513",i.lineWidth=2,i.beginPath(),i.moveTo(l+13,s+6),i.lineTo(l+19,s+7),i.moveTo(l+21,s+7),i.lineTo(l+27,s+6),i.stroke(),e.carrying&&this.drawRealisticTrash(e.carrying,l+15,s-20,.8),i.globalAlpha=1}drawRealisticTrash(i,e,t,a=1){const l=this.ctx,s=i.width*a,o=i.height*a;switch(l.save(),l.translate(e+s/2,t+o/2),l.rotate(i.rotation||0),l.translate(-s/2,-o/2),l.fillStyle="rgba(45, 80, 22, 0.3)",l.fillRect(4,4,s,o),i.shape){case"bottle":this.drawBottle(l,0,0,s,o,i.color,i.detailColor);break;case"can":this.drawCan(l,0,0,s,o,i.color,i.detailColor);break;case"paper":this.drawPaper(l,0,0,s,o,i.color,i.detailColor);break;case"banana":this.drawBanana(l,0,0,s,o,i.color,i.detailColor);break;case"apple":this.drawApple(l,0,0,s,o,i.color,i.detailColor);break;case"leaves":this.drawLeaves(l,0,0,s,o,i.color,i.detailColor);break;case"wrapper":this.drawWrapper(l,0,0,s,o,i.color,i.detailColor);break;case"gum":this.drawGum(l,0,0,s,o,i.color,i.detailColor);break;case"bag":this.drawChipBag(l,0,0,s,o,i.color,i.detailColor);break}l.restore()}drawBottle(i,e,t,a,l,s,o){const h=i.createLinearGradient(e,t,e+a,t+l);h.addColorStop(0,this.lightenColor(s,.3)),h.addColorStop(.5,s),h.addColorStop(1,this.darkenColor(s,.3)),i.fillStyle=h,i.fillRect(e+a*.2,t+l*.3,a*.6,l*.6),i.fillStyle=this.darkenColor(s,.2),i.fillRect(e+a*.35,t,a*.3,l*.4),i.fillStyle=o,i.fillRect(e+a*.3,t,a*.4,l*.15),i.fillStyle="white",i.fillRect(e+a*.25,t+l*.4,a*.5,l*.2),i.fillStyle="rgba(255,255,255,0.6)",i.fillRect(e+a*.25,t+l*.35,a*.15,l*.3)}drawCan(i,e,t,a,l,s,o){const h=i.createRadialGradient(e+a/2,t+l/2,0,e+a/2,t+l/2,a/2);h.addColorStop(0,this.lightenColor(s,.4)),h.addColorStop(.7,s),h.addColorStop(1,this.darkenColor(s,.3)),i.fillStyle=h,i.fillRect(e,t+l*.1,a,l*.8),i.fillStyle=this.darkenColor(s,.4),i.fillRect(e,t,a,l*.15),i.fillRect(e,t+l*.85,a,l*.15),i.fillStyle=o,i.beginPath(),i.arc(e+a*.7,t+l*.1,a*.1,0,Math.PI*2),i.fill(),i.fillStyle=o,i.fillRect(e,t+l*.4,a,l*.2),i.fillStyle="rgba(255,255,255,0.5)",i.fillRect(e+a*.1,t+l*.2,a*.2,l*.6)}drawPaper(i,e,t,a,l,s,o){i.fillStyle=s,i.beginPath(),i.moveTo(e,t),i.lineTo(e+a*.8,t),i.lineTo(e+a,t+l*.2),i.lineTo(e+a,t+l),i.lineTo(e,t+l),i.closePath(),i.fill(),i.fillStyle=this.darkenColor(s,.2),i.beginPath(),i.moveTo(e+a*.8,t),i.lineTo(e+a,t+l*.2),i.lineTo(e+a*.8,t+l*.2),i.closePath(),i.fill(),i.strokeStyle=o,i.lineWidth=1;for(let h=0;h<4;h++)i.beginPath(),i.moveTo(e+a*.1,t+l*.3+h*l*.15),i.lineTo(e+a*.7,t+l*.3+h*l*.15),i.stroke()}drawBanana(i,e,t,a,l,s,o){i.fillStyle=s,i.beginPath(),i.moveTo(e+a*.2,t+l*.8),i.quadraticCurveTo(e+a*.1,t+l*.3,e+a*.4,t+l*.1),i.quadraticCurveTo(e+a*.7,t,e+a*.9,t+l*.2),i.quadraticCurveTo(e+a*.8,t+l*.4,e+a*.6,t+l*.6),i.quadraticCurveTo(e+a*.4,t+l*.9,e+a*.2,t+l*.8),i.fill(),i.fillStyle=o,i.beginPath(),i.arc(e+a*.3,t+l*.4,a*.08,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(e+a*.6,t+l*.3,a*.06,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(s,.3),i.fillRect(e+a*.35,t+l*.2,a*.15,l*.4)}drawApple(i,e,t,a,l,s,o){i.fillStyle=s,i.beginPath(),i.arc(e+a/2,t+l*.6,a*.4,0,Math.PI*2),i.fill(),i.fillStyle=this.darkenColor(s,.3),i.beginPath(),i.arc(e+a/2,t+l*.3,a*.15,0,Math.PI),i.fill(),i.fillStyle=o,i.fillRect(e+a*.48,t+l*.1,a*.04,l*.2),i.fillStyle=o,i.beginPath(),i.ellipse(e+a*.6,t+l*.15,a*.1,a*.05,Math.PI/4,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(s,.4),i.beginPath(),i.arc(e+a*.35,t+l*.45,a*.1,0,Math.PI*2),i.fill()}drawLeaves(i,e,t,a,l,s,o){for(let h=0;h<3;h++){const r=e+h*a*.2,n=t+h*l*.1;i.fillStyle=h===0?s:this.darkenColor(s,.2*h),i.beginPath(),i.ellipse(r+a*.3,n+l*.3,a*.25,l*.4,h*.3,0,Math.PI*2),i.fill(),i.strokeStyle=o,i.lineWidth=1,i.beginPath(),i.moveTo(r+a*.3,n+l*.1),i.lineTo(r+a*.3,n+l*.5),i.stroke()}}drawWrapper(i,e,t,a,l,s,o){i.fillStyle=s,i.beginPath(),i.moveTo(e,t+l*.2),i.lineTo(e+a*.3,t),i.lineTo(e+a*.7,t+l*.1),i.lineTo(e+a,t+l*.3),i.lineTo(e+a*.8,t+l*.7),i.lineTo(e+a*.9,t+l),i.lineTo(e+a*.2,t+l*.9),i.lineTo(e,t+l*.6),i.closePath(),i.fill(),i.fillStyle=this.lightenColor(s,.4),i.fillRect(e+a*.2,t+l*.2,a*.2,l*.15),i.fillRect(e+a*.6,t+l*.5,a*.15,l*.2),i.fillStyle=o,i.fillRect(e+a*.3,t+l*.4,a*.4,l*.1)}drawGum(i,e,t,a,l,s,o){i.fillStyle=s,i.beginPath(),i.arc(e+a*.3,t+l*.4,a*.25,0,Math.PI*2),i.fill(),i.beginPath(),i.arc(e+a*.6,t+l*.6,a*.2,0,Math.PI*2),i.fill(),i.strokeStyle=this.lightenColor(s,.2),i.lineWidth=2,i.beginPath(),i.moveTo(e+a*.5,t+l*.2),i.quadraticCurveTo(e+a*.3,t+l*.1,e+a*.4,t),i.stroke()}drawChipBag(i,e,t,a,l,s,o){const h=i.createLinearGradient(e,t,e+a,t);h.addColorStop(0,this.lightenColor(s,.2)),h.addColorStop(.5,s),h.addColorStop(1,this.darkenColor(s,.2)),i.fillStyle=h,i.beginPath(),i.moveTo(e+a*.1,t),i.lineTo(e+a*.9,t),i.lineTo(e+a*.8,t+l),i.lineTo(e+a*.2,t+l),i.closePath(),i.fill(),i.fillStyle=o,i.fillRect(e+a*.2,t+l*.3,a*.6,l*.4),i.strokeStyle=this.darkenColor(s,.3),i.lineWidth=1;for(let r=0;r<3;r++)i.beginPath(),i.moveTo(e+a*.1,t+l*.2+r*l*.3),i.lineTo(e+a*.9,t+l*.25+r*l*.3),i.stroke()}draw3DTrash(i,e,t,a=1){const l=this.ctx,s=i.width*a,o=i.height*a,h=8*a;l.fillStyle="rgba(0,0,0,0.3)",l.fillRect(e+h/2,t+o+h/2,s,o/2),l.fillStyle=this.lightenColor(i.color,.3),l.beginPath(),l.moveTo(e,t),l.lineTo(e+s,t),l.lineTo(e+s+h,t-h),l.lineTo(e+h,t-h),l.closePath(),l.fill();const r=l.createLinearGradient(e,t,e+s,t+o);r.addColorStop(0,i.color),r.addColorStop(1,this.darkenColor(i.color,.2)),l.fillStyle=r,l.fillRect(e,t,s,o),l.fillStyle=this.darkenColor(i.color,.4),l.beginPath(),l.moveTo(e+s,t),l.lineTo(e+s+h,t-h),l.lineTo(e+s+h,t+o-h),l.lineTo(e+s,t+o),l.closePath(),l.fill(),l.fillStyle="rgba(255,255,255,0.4)",l.fillRect(e+2,t+2,s/3,o/3),l.fillStyle="white",l.font=`bold ${Math.floor(10*a)}px Arial`,l.textAlign="center",l.strokeStyle="black",l.lineWidth=1,l.strokeText(i.item,e+s/2,t+o/2+3),l.fillText(i.item,e+s/2,t+o/2+3),i.type==="recycle"?(l.fillStyle="#00AA00",l.font=`${Math.floor(8*a)}px Arial`,l.fillText("‚ôª",e+s-6,t+10)):i.type==="compost"&&(l.fillStyle="#88AA00",l.font=`${Math.floor(8*a)}px Arial`,l.fillText("üçÉ",e+s-6,t+10))}lightenColor(i,e){const t=parseInt(i.slice(1),16),a=Math.min(255,Math.floor((t>>16)+(255-(t>>16))*e)),l=Math.min(255,Math.floor((t>>8&255)+(255-(t>>8&255))*e)),s=Math.min(255,Math.floor((t&255)+(255-(t&255))*e));return`rgb(${a},${l},${s})`}drawBin(i){const e=this.ctx,t=e.createLinearGradient(i.x,0,i.x+i.width,0);t.addColorStop(0,i.color),t.addColorStop(.3,i.color),t.addColorStop(.7,this.darkenColor(i.color,.3)),t.addColorStop(1,this.darkenColor(i.color,.5)),e.fillStyle=t,e.fillRect(i.x,i.y,i.width,i.height),e.fillStyle=this.darkenColor(i.color,.2),e.fillRect(i.x-5,i.y-8,i.width+10,10),e.fillStyle="#666",e.fillRect(i.x+i.width/2-3,i.y-12,6,8),e.fillStyle="white",e.font="bold 32px Arial",e.textAlign="center",i.type==="recycle"?e.fillText("‚ôª",i.x+i.width/2,i.y+i.height/2+8):i.type==="compost"?e.fillText("üçé",i.x+i.width/2,i.y+i.height/2+8):e.fillText("üóë",i.x+i.width/2,i.y+i.height/2+8),e.fillStyle="white",e.font="bold 16px Arial",e.fillText(i.label,i.x+i.width/2,i.y-15)}drawObstacle(i){const e=this.ctx,t=15;switch(e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(i.x+t/2,i.y+i.height+t/2,i.width,i.height/3),i.type){case"slide":this.drawSlide(e,i,t);break;case"roundabout":this.drawRoundabout(e,i,t);break;case"seesaw":this.drawSeesaw(e,i,t);break;case"swing":this.drawSwing(e,i,t);break;case"tree":this.drawTree(e,i,t);break;case"bench":this.drawBench(e,i,t);break}}drawSlide(i,e,t){i.fillStyle=this.darkenColor(e.color,.3),i.fillRect(e.x+t,e.y+t,e.width,e.height),i.fillStyle=e.color,i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle=this.darkenColor(e.color,.5),i.beginPath(),i.moveTo(e.x+e.width,e.y),i.lineTo(e.x+e.width+t,e.y+t),i.lineTo(e.x+e.width+t,e.y+e.height+t),i.lineTo(e.x+e.width,e.y+e.height),i.closePath(),i.fill(),i.fillStyle=this.lightenColor(e.color,.2),i.beginPath(),i.moveTo(e.x+10,e.y+10),i.lineTo(e.x+e.width-10,e.y+e.height-10),i.lineTo(e.x+e.width-5,e.y+e.height-10),i.lineTo(e.x+15,e.y+10),i.closePath(),i.fill()}drawRoundabout(i,e,t){const a=e.x+e.width/2,l=e.y+e.height/2,s=e.width/2;i.fillStyle=this.darkenColor(e.color,.5),i.beginPath(),i.arc(a+t/2,l+t/2,s,0,Math.PI*2),i.fill(),i.fillStyle=e.color,i.beginPath(),i.arc(a,l,s,0,Math.PI*2),i.fill(),i.fillStyle=this.darkenColor(e.color,.3),i.beginPath(),i.arc(a,l,s/4,0,Math.PI*2),i.fill(),i.strokeStyle="#666",i.lineWidth=4;for(let o=0;o<4;o++){const h=o*Math.PI/2,r=a+Math.cos(h)*s*.7,n=l+Math.sin(h)*s*.7;i.beginPath(),i.arc(r,n,3,0,Math.PI*2),i.stroke()}}drawSeesaw(i,e,t){const a=e.x+e.width/2,l=e.y+e.height/2;i.fillStyle=this.darkenColor(e.color,.4),i.beginPath(),i.moveTo(a-10,l),i.lineTo(a+10,l),i.lineTo(a,e.y+e.height),i.closePath(),i.fill(),i.fillStyle=e.color,i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle=this.darkenColor(e.color,.3),i.fillRect(e.x+t,e.y+t,e.width,e.height/3),i.fillStyle=this.lightenColor(e.color,.2),i.fillRect(e.x+5,e.y-5,15,10),i.fillRect(e.x+e.width-20,e.y-5,15,10)}drawSwing(i,e,t){i.strokeStyle=e.color,i.lineWidth=6,i.beginPath(),i.moveTo(e.x,e.y+e.height),i.lineTo(e.x+e.width/2,e.y),i.lineTo(e.x+e.width,e.y+e.height),i.stroke(),i.beginPath(),i.moveTo(e.x+5,e.y+10),i.lineTo(e.x+e.width-5,e.y+10),i.stroke(),i.strokeStyle="#666",i.lineWidth=2;const a=e.x+e.width/2;i.beginPath(),i.moveTo(a-3,e.y+10),i.lineTo(a-3,e.y+e.height-10),i.moveTo(a+3,e.y+10),i.lineTo(a+3,e.y+e.height-10),i.stroke(),i.fillStyle="#8B4513",i.fillRect(a-8,e.y+e.height-15,16,6)}drawTree(i,e,t){const a=e.x+e.width/2,l=e.width*.3,s=e.height*.6,o=e.width*.4;i.fillStyle="rgba(0,0,0,0.3)",i.beginPath(),i.arc(a+t/2,e.y+e.height+t/2,o*1.2,0,Math.PI*2),i.fill(),i.fillStyle="#8B4513",i.fillRect(a-l/2,e.y+e.height-s,l,s),i.fillStyle=this.darkenColor("#8B4513",.3),i.fillRect(a-l/2+t/2,e.y+e.height-s+t/2,l/2,s),i.fillStyle=this.darkenColor(e.color,.3),i.beginPath(),i.arc(a+t/3,e.y+o+t/3,o,0,Math.PI*2),i.fill(),i.fillStyle=e.color,i.beginPath(),i.arc(a,e.y+o,o,0,Math.PI*2),i.fill(),i.fillStyle=this.lightenColor(e.color,.3),i.beginPath(),i.arc(a-o/3,e.y+o/2,o/2,0,Math.PI*2),i.fill()}drawBench(i,e,t){i.fillStyle=e.color,i.fillRect(e.x,e.y,e.width,e.height),i.fillStyle=this.darkenColor(e.color,.4),i.beginPath(),i.moveTo(e.x+e.width,e.y),i.lineTo(e.x+e.width+t,e.y+t),i.lineTo(e.x+e.width+t,e.y+e.height+t),i.lineTo(e.x+e.width,e.y+e.height),i.closePath(),i.fill();const a=8,l=e.height+10;i.fillStyle=this.darkenColor(e.color,.2),i.fillRect(e.x+5,e.y+e.height,a,l),i.fillRect(e.x+15,e.y+e.height,a,l),i.fillRect(e.x+e.width-23,e.y+e.height,a,l),i.fillRect(e.x+e.width-13,e.y+e.height,a,l),i.fillStyle=e.color,i.fillRect(e.x,e.y-20,e.width,15)}drawTurkey(i){const e=this.ctx;i.animFrame=(i.animFrame||0)+.2,i.animFrame>=8&&(i.animFrame=0);const t=Math.sin(i.animFrame*2)*(i.chasing?3:1),a=1+(i.aggressionLevel||0)*.2;e.fillStyle="rgba(0,0,0,0.25)",e.beginPath(),e.ellipse(i.x+i.width/2,i.y+i.height+5,i.width/2*a,8,0,0,Math.PI*2),e.fill();let l=i.chasing?"#AA0000":"#8B4513";i.aggressionLevel>.5&&(l=i.chasing?"#FF0000":"#A0522D"),e.fillStyle=l,e.beginPath(),e.ellipse(i.x+i.width/2,i.y+i.height/2+t,18*a,15*a,0,0,Math.PI*2),e.fill();const s=i.chasing?7:5,o=i.chasing?.4:.3;for(let p=0;p<s;p++){const c=(p-s/2)*o,y=i.chasing?20:16,S=i.x+i.width/2-Math.cos(c)*15,T=i.y+i.height/2-Math.sin(c)*10+t,v=["#654321","#8B4513","#A0522D"];e.fillStyle=v[p%3],e.save(),e.translate(S,T),e.rotate(c),e.fillRect(-3,-y/2,6,y),e.fillStyle=i.chasing?"#FF4444":"#D2691E",e.fillRect(-2,-y/2,4,4),e.restore()}e.fillStyle="#A0522D";const h=i.chasing?Math.sin(i.animFrame*4)*3:0;e.save(),e.translate(i.x+8,i.y+12+t),e.rotate(h*.1),e.fillRect(0,0,12,16),e.restore(),e.save(),e.translate(i.x+25,i.y+12+t),e.rotate(-h*.1),e.fillRect(0,0,12,16),e.restore();const r=i.chasing?16:12;e.fillStyle="#D2691E",e.fillRect(i.x+15,i.y+5+t,8,r);const n=i.chasing?8:6;e.fillStyle=l,e.beginPath(),e.arc(i.x+19,i.y+8+t,n,0,Math.PI*2),e.fill(),e.fillStyle="#F5A623",i.chasing?(e.beginPath(),e.moveTo(i.x+26,i.y+6+t),e.lineTo(i.x+32,i.y+4+t),e.lineTo(i.x+30,i.y+8+t),e.fill(),e.beginPath(),e.moveTo(i.x+26,i.y+10+t),e.lineTo(i.x+32,i.y+12+t),e.lineTo(i.x+30,i.y+8+t),e.fill()):(e.beginPath(),e.moveTo(i.x+26,i.y+8+t),e.lineTo(i.x+30,i.y+6+t),e.lineTo(i.x+26,i.y+10+t),e.fill()),e.fillStyle=i.chasing?"#FF0000":"#FF6B6B",e.beginPath(),e.arc(i.x+19,i.y+14+t,i.chasing?4:3,0,Math.PI),e.fill(),e.fillStyle="white",e.beginPath(),e.arc(i.x+21,i.y+6+t,2.5,0,Math.PI*2),e.fill(),e.fillStyle=i.chasing?"#FF0000":"black",e.beginPath(),e.arc(i.x+22,i.y+6+t,i.chasing?2:1,0,Math.PI*2),e.fill(),i.chasing&&(e.strokeStyle="#AA0000",e.lineWidth=2,e.beginPath(),e.moveTo(i.x+18,i.y+3+t),e.lineTo(i.x+24,i.y+5+t),e.stroke()),e.fillStyle="#F5A623";const d=i.chasing?4:2,f=Math.sin(i.animFrame*d)*2,g=Math.sin(i.animFrame*d+Math.PI)*2;if(e.fillRect(i.x+12,i.y+i.height-5+f,4,10),e.fillRect(i.x+22,i.y+i.height-5+g,4,10),e.strokeStyle="#F5A623",e.lineWidth=i.chasing?3:2,e.beginPath(),e.moveTo(i.x+10,i.y+i.height+5+f),e.lineTo(i.x+18,i.y+i.height+5+f),i.chasing&&(e.moveTo(i.x+8,i.y+i.height+3+f),e.lineTo(i.x+10,i.y+i.height+5+f)),e.stroke(),e.beginPath(),e.moveTo(i.x+20,i.y+i.height+5+g),e.lineTo(i.x+28,i.y+i.height+5+g),i.chasing&&(e.moveTo(i.x+28,i.y+i.height+3+g),e.lineTo(i.x+30,i.y+i.height+5+g)),e.stroke(),i.chasing&&Math.random()<.3)for(let p=0;p<3;p++)this.particles.push({x:i.x+i.width/2+(Math.random()-.5)*10,y:i.y+i.height+5,vx:(Math.random()-.5)*2,vy:Math.random()*-2,life:15,maxLife:15,color:"#D2B48C",size:Math.random()*3+1,type:"dust"})}darkenColor(i,e){const t=parseInt(i.slice(1),16),a=Math.floor((t>>16)*(1-e)),l=Math.floor((t>>8&255)*(1-e)),s=Math.floor((t&255)*(1-e));return`rgb(${a},${l},${s})`}lightenColor(i,e){const t=parseInt(i.slice(1),16),a=Math.min(255,Math.floor((t>>16)+(255-(t>>16))*e)),l=Math.min(255,Math.floor((t>>8&255)+(255-(t>>8&255))*e)),s=Math.min(255,Math.floor((t&255)+(255-(t&255))*e));return`rgb(${a},${l},${s})`}isColliding(i,e){return i.x<e.x+e.width&&i.x+i.width>e.x&&i.y<e.y+e.height&&i.y+i.height>e.y}render(){const i=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);i.addColorStop(0,"#90EE90"),i.addColorStop(.5,"#7ED321"),i.addColorStop(1,"#5CB85C"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawPlayground(),this.obstacles.forEach(e=>{this.drawObstacle(e)}),this.bins.forEach(e=>{this.drawBin(e)}),this.trash.forEach(e=>{this.drawRealisticTrash(e,e.x,e.y)}),this.enemies.forEach(e=>{this.drawTurkey(e)}),this.drawPlayer(),this.particles.forEach(e=>{this.ctx.save(),this.ctx.globalAlpha=e.alpha||1,e.type==="scoreText"?(this.ctx.fillStyle=e.color,this.ctx.font=`bold ${e.size}px Arial`,this.ctx.textAlign="center",this.ctx.strokeStyle="#2D5016",this.ctx.lineWidth=2,this.ctx.strokeText(e.text,e.x,e.y),this.ctx.fillText(e.text,e.x,e.y)):(this.ctx.fillStyle=e.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,e.size,0,Math.PI*2),this.ctx.fill()),this.ctx.restore()})}drawPlayground(){this.ctx.fillStyle="#8B4513",this.ctx.fillRect(600,400,10,100),this.ctx.fillRect(700,400,10,100),this.ctx.fillRect(590,400,130,10),this.ctx.fillStyle="#FFD700",this.ctx.fillRect(500,100,80,20),this.ctx.fillRect(500,120,20,80),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(300,450,15,60),this.ctx.fillRect(750,50,15,80),this.ctx.fillStyle="#228B22",this.ctx.beginPath(),this.ctx.arc(307,440,30,0,Math.PI*2),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(757,40,35,0,Math.PI*2),this.ctx.fill()}updateUI(){document.getElementById("score").textContent=this.score,document.getElementById("carrying").textContent=this.player.carrying?this.player.carrying.item:"Nothing"}startTimer(){this.timerInterval=setInterval(()=>{this.timeLeft--,document.getElementById("timer").textContent=this.timeLeft,this.timeLeft<=0&&this.endGame()},1e3)}endGame(){this.gameState="gameOver",clearInterval(this.timerInterval),document.getElementById("finalScore").textContent=this.score,document.getElementById("gameOver").style.display="block"}async submitScore(){const i=document.getElementById("playerName").value.trim()||"Anonymous";try{const e=await fetch(`${this.apiUrl}/scores`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({player_name:i,score:this.score})});if(e.ok){const t=await e.json();console.log("Score submitted successfully:",t),this.loadLeaderboard(),this.showMessage("Score saved!","#7ED321")}else throw new Error("Failed to submit score")}catch(e){console.error("Error submitting score:",e),this.submitScoreOffline(i),this.showMessage("Score saved locally (offline)","#F5A623")}}submitScoreOffline(i){const e=this.getStoredScores();e.push({name:i,score:this.score,date:new Date().toLocaleDateString()}),e.sort((t,a)=>a.score-t.score),e.splice(10),localStorage.setItem("recycleGameScores",JSON.stringify(e)),this.displayLeaderboardOffline()}async loadLeaderboard(){try{const i=await fetch(`${this.apiUrl}/scores`);if(i.ok){const e=await i.json();this.displayLeaderboard(e)}else throw new Error("Failed to load leaderboard")}catch(i){console.error("Error loading leaderboard:",i),this.displayLeaderboardOffline()}}getStoredScores(){const i=localStorage.getItem("recycleGameScores");return i?JSON.parse(i):[]}displayLeaderboard(i){const e=document.getElementById("scores");i&&i.length>0?e.innerHTML=i.slice(0,5).map((t,a)=>`${a+1}. ${t.player_name}: ${t.score}`).join("<br>"):e.innerHTML="No scores yet!"}displayLeaderboardOffline(){const i=this.getStoredScores(),e=document.getElementById("scores");e.innerHTML=i.slice(0,5).map((t,a)=>`${a+1}. ${t.name}: ${t.score} (offline)`).join("<br>")}showMessage(i,e="#FFFFFF"){const t=document.createElement("div");t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.background="rgba(0,0,0,0.8)",t.style.color=e,t.style.padding="20px",t.style.borderRadius="10px",t.style.fontSize="18px",t.style.fontWeight="bold",t.style.zIndex="1000",t.style.animation="fadeInOut 2s ease-in-out",t.textContent=i;const a=document.createElement("style");a.textContent=`
      @keyframes fadeInOut {
        0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      }
    `,document.head.appendChild(a),document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t),document.head.removeChild(a)},2e3)}restart(){this.gameState="playing",this.timeLeft=this.gameTime,this.score=0,this.player.x=400,this.player.y=300,this.player.carrying=null,this.player.vx=0,this.player.vy=0,this.trash=[],this.enemies=[],this.spawnTrash(),this.spawnEnemies(),document.getElementById("gameOver").style.display="none",document.getElementById("playerName").value="",this.updateUI(),this.startTimer()}gameLoop(){this.gameState==="playing"&&(this.updatePlayer(),this.updateEnemies(),this.updateParticles(),this.checkCollisions()),this.render(),requestAnimationFrame(()=>this.gameLoop())}}window.addEventListener("load",()=>{window.game=new u});
